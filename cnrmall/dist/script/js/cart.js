define(["config"],function(){require(["jquery"],function(){require(["cookie"],function(){function o(){1==$(".catr-goods-list ul li").size()?($(".catr-goods-list .no-data").show(),$(".float-bar").hide()):($(".catr-goods-list .no-data").hide(),$(".float-bar").show())}if(o(),$.cookie("cookiesid")&&$.cookie("cookienum")){var n=$.cookie("cookiesid").split(","),s=$.cookie("cookienum").split(",");$.each(n,function(i,t){var e,c;e=n[i],c=s[i],$.ajax({type:"get",url:"http://10.31.155.114/1808-5/shenqiuyun/cnrmall/php/get_cart_data.php",async:!0,dataType:"json"}).done(function(i){$.each(i,function(i,t){if(e==t.id){var n=$(".li-itme:hidden").clone(!0,!0);n.find("a").attr("href","details.html?id="+t.id),n.find(".cart-list-img").find("img").attr("src",t.imgsrc),n.find(".cart-list-img").find("img").attr("sid",t.sid),n.find(".cart-list-title").find("a").html(t.title),n.find(".cart-list-title").find("p").html(t.description),n.find("#mnBuyNumInput").val(c),n.find(".original-price").html(t.original_price),n.find(".limit_buy").html(t.limit_buy),n.find(".b-prc").html(t.price),n.find(".price").html((t.price*c).toFixed(2)),n.css("display","block"),$(".cart-ul-list").append(n)}o()})}).fail(function(){console.log("响应失败")})})}function c(){var n=0,e=0;$.each($(".catr-goods-list ul li:visible"),function(i,t){$(t).find(".cart-list-checkbox input").prop("checked")&&(n+=parseInt($(t).find(".price").text()),e+=parseInt($(t).find("#mnBuyNumInput").val()))}),$(".float-bar-right").find("b").text(n.toFixed(2)),$(".float-bar-right").find("i").text(e)}$(".amount .plus").on("click",function(){var i=$(this).parents("li"),t=i.find("#mnBuyNumInput").val(),n=i.find(".limit_buy").text(),e=i.find(".b-prc").text();$(this).siblings(".minus").removeClass("crisis"),n<=++t&&($(this).addClass("crisis"),t=n),i.find("#mnBuyNumInput").val(t),i.find(".price").text((t*e).toFixed(2)),c(),r($(this))}),$(".amount .minus").on("click",function(){var i=$(this).parents("li"),t=i.find("#mnBuyNumInput").val(),n=i.find(".b-prc").text();$(this).siblings(".plus").removeClass("crisis"),--t<1&&($(this).addClass("crisis"),t=1),i.find("#mnBuyNumInput").val(t),i.find(".price").text((t*n).toFixed(2)),c(),r($(this))}),$("#mnBuyNumInput").on("input",function(){var i=$(this).parents("li"),t=i.find(".limit_buy").text(),n=i.find(".b-prc").text(),e=parseInt($(this).val());/^\d+$/g.test(e)?t<=e?$(this).val(t):e<=0?$(this).val(1):$(this).val(e):$(this).val(1),i.find(".price").text(($(this).val()*n).toFixed(2)),c(),r($(this))}),$(".checkedall").on("change",function(){$(".checkedall").prop("checked",$(this).prop("checked")),$(".catr-goods-list ul li:visible").find(".cart-list-checkbox input").prop("checked",$(this).prop("checked")),c(),d()});var i=$(".catr-goods-list ul li:visible").find(":checkbox");$(".catr-goods-list ul").on("change",i,function(){$(".catr-goods-list ul li:visible").find("input:checkbox").length==$(".catr-goods-list ul").find("input:checked").size()?$(".checkedall").prop("checked",!0):$(".checkedall").prop("checked",!1),c(),d()});var e=[],l=[];function a(){$.cookie("cookiesid")&&$.cookie("cookienum")&&(e=$.cookie("cookiesid").split(","),l=$.cookie("cookienum").split(","))}function r(i){a();var t=i.parents(".li-item").find("img").attr("sid");l[$.inArray(t,e)]=i.parents(".li-item").find("#mnBuyNumInput").val(),$.cookie("cookienum",l.toString(),{expires:7})}function t(n,i){var e=-1;$.each(i,function(i,t){n==t&&(e=i)}),i.splice(e,1),l.splice(e,1),$.cookie("cookiesid",i.toString(),{expires:7}),$.cookie("cookienum",l.toString(),{expires:7})}function d(){0<$(".float-bar-right").find("i").html()?$(".float-bar-right").find("button").addClass("active"):$(".float-bar-right").find("button").removeClass("active")}$(".delete-btn").on("click",function(){a(),confirm("你确认要删除吗？")&&($(this).parents("li").remove(),o()),t($(this).first().parents(".li-itme").find("img").attr("sid"),e),c()}),$(".del-check").on("click",function(){a(),0==$(".catr-goods-list ul").find("input:checked").size()?alert("请选择要删除的商品！"):confirm("你确认要删除吗？")&&($(".catr-goods-list ul li").each(function(){$(this).find("input:checkbox").is(":checked")&&($(this).remove(),t($(this).find("img").attr("sid"),e))}),c(),o(),d())})})})});